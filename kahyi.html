<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>자바스크립트로 된 가희 처리기</title>
        <script type="application/javascript" src="kahyi.js" charset="utf-8"></script>
        <style type="text/css">
            textarea {
                font-family: monospace;
            }
            .group {
                margin: 1.2em 0;
            }
        </style>
        <script type="application/javascript">
            var k;
            function codeChanged() {
                document.getElementById('run').setAttribute('disabled', 'disabled');
                document.getElementById('step').setAttribute('disabled', 'disabled');
            }
            function load() {
                document.getElementById('output').value = '';
                var c = document.getElementById('code').value;
                k = Kahyi(c);
                k.onOutput.push(function(output) {
                    document.getElementById('output').value += output.value;
                });
                if (document.getElementById('input').value.length > 0) {
                    var t = document.getElementById('input').value.split('');
                    t.push(undefined);
                    k.instances[k.mainInstanceId].instance.in = t;
                }
                document.getElementById('run').removeAttribute('disabled');
                document.getElementById('step').removeAttribute('disabled');
            }
            function run() {
                document.getElementById('code').setAttribute('readonly', 'readonly');
                document.getElementById('input').setAttribute('readonly', 'readonly');
                document.getElementById('load').setAttribute('disabled', 'disabled');
                document.getElementById('run').setAttribute('disabled', 'disabled');
                document.getElementById('step').setAttribute('disabled', 'disabled');
                document.getElementById('stop').removeAttribute('disabled');
                k.run();
            }
            function step() {
                k.instances[k.mainInstanceId].instance.step();
            }
            function stop() {
                k.stop();
                if (k.instances[k.mainInstanceId].instance.fineTime !== undefined)
                    console.log('elapsed: ' + (k.instances[k.mainInstanceId].instance.fineTime - k.instances[k.mainInstanceId].instance.beginTime) + 'ms)');
                document.getElementById('code').removeAttribute('readonly');
                document.getElementById('input').removeAttribute('readonly');
                document.getElementById('load').removeAttribute('disabled');
                document.getElementById('run').removeAttribute('disabled');
                document.getElementById('step').removeAttribute('disabled');
                document.getElementById('stop').setAttribute('disabled', 'disabled');
            }
        </script>
    </head>
    <body>
        <div>
            <div class="group">
                <span>Code:</span><br />
                <textarea id="code" rows="24" cols="80" oninput="codeChanged()"></textarea>
            </div>
            <div class="group">
                <span>Input:</span><br />
                <textarea id="input" rows="12" cols="80" oninput="codeChanged()"></textarea>
            </div>
            <button id="load" onclick="load()">Load</button>
            <button id="run" onclick="run()" disabled="disabled">Run</button>
            <button id="step" onclick="step()" disabled="disabled">Step</button>
            <button id="stop" onclick="stop()" disabled="disabled">Stop</button>
            <div class="group">
                <span>Output:</span><br />
                <textarea id="output" rows="12" cols="80" readonly="readonly"></textarea>
            </div>
        </div>
    </body>
</html>
